<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="theme.css">
    <script src="theme.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComicCore - Settings</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        /* colors now in theme.css */

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; padding-bottom: 80px; }
        .nav { padding: 20px; display: flex; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: var(--bg); z-index: 10; }
        .back-btn { cursor: pointer; margin-right: 15px; font-size: 20px; text-decoration: none; color: var(--text); font-weight: bold; }
        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        
        .section-label { font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin: 25px 0 10px 5px; letter-spacing: 1px; }
        .settings-group { background: var(--card); border-radius: 18px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 10px; }
        
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid var(--border); }
        .setting-item:last-child { border-bottom: none; }
        .item-info { display: flex; flex-direction: column; gap: 4px; }
        .item-info span { font-weight: 600; font-size: 15px; }
        .item-info small { color: #888; font-size: 12px; line-height: 1.3; }

        .theme-btn-group { display: flex; gap: 8px; padding: 10px 16px; }
        .t-btn { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: var(--input); color: var(--text); cursor: pointer; font-size: 12px; font-weight: 700; transition: 0.2s; }
        .t-btn.active { border-color: var(--accent); background: var(--accent); color: white; }
        
        input[type="number"], select { background: var(--input); border: 1px solid var(--border); color: var(--text); padding: 8px; border-radius: 8px; outline: none; }
        .action-link { color: var(--accent); font-weight: 600; cursor: pointer; font-size: 14px; }

        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(18px); }

        /* --- NEW: Bottom Nav Style --- */
        .nav-bottom {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background: #000; border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        .nav-item { font-size: 20px; cursor: pointer; opacity: 0.6; text-decoration: none; color: white; }
        .nav-item.active { opacity: 1; color: var(--accent); }
    </style>
</head>
<body>

<div class="nav">
    <a href="index.html" class="back-btn">‚Üê</a>
    <span style="font-size: 18px; font-weight: 700;">Settings</span>
</div>

<div class="container">
    <div class="section-label">Community</div>
    <div class="settings-group">
        <div class="setting-item" onclick="location.href='discover.html'" style="cursor:pointer;">
            <div class="item-info">
                <span>Go to Discover</span>
                <small>Find new comics and creators.</small>
            </div>
            <span class="action-link">Explore ‚Üí</span>
        </div>
    </div>

    <div class="section-label">Privacy</div>
    <div class="settings-group">
        <div class="setting-item">
            <div class="item-info"><span>Open for Team</span><small>Allow team members to contact you.</small></div>
            <label class="switch"><input type="checkbox" id="privacy-team" onchange="saveSetting('cc-privacy-team', this.checked)"><span class="slider"></span></label>
        </div>
        <div class="setting-item">
            <div class="item-info"><span>Direct Messages</span><small>Allow others to send you DMs.</small></div>
            <label class="switch"><input type="checkbox" id="privacy-dm" onchange="saveSetting('cc-privacy-dm', this.checked)"><span class="slider"></span></label>
        </div>
        <div class="setting-item">
            <div class="item-info"><span>Friend Requests</span><small>Allow others to send friend requests.</small></div>
            <label class="switch"><input type="checkbox" id="privacy-friends" onchange="saveSetting('cc-privacy-friends', this.checked)"><span class="slider"></span></label>
        </div>
        <div class="setting-item">
            <div class="item-info"><span>Show Followers/Following</span><small>Let others tap your follower counts to see your connections list.</small></div>
            <label class="switch"><input type="checkbox" id="privacy-followers" onchange="saveSetting('cc-privacy-followers', this.checked)"><span class="slider"></span></label>
        </div>
        <div class="setting-item">
            <div class="item-info"><span>Message Requests</span><small>Allow others to send you friend/message requests.</small></div>
            <label class="switch"><input type="checkbox" id="privacy-requests" onchange="saveSetting('cc-privacy-requests', this.checked)"><span class="slider"></span></label>
        </div>
    </div>

    <div class="section-label">Display Settings</div>
    <div class="settings-group">

        <div class="setting-item">
            <span>Swipe Direction</span>
            <select id="swipe-dir" onchange="saveSetting('cc-swipe-dir', this.value)">
                <option value="creator">Set by Creator (default)</option>
                <option value="horizontal">Always Horizontal</option>
                <option value="vertical">Always Vertical</option>
            </select>
        </div>
        <div class="setting-item">
            <span>Show FPS</span>
            <label class="switch"><input type="checkbox" id="show-fps" onchange="saveSetting('cc-show-fps', this.checked)"><span class="slider"></span></label>
        </div>
    </div>

    <div class="section-label">Appearance</div>
    <div class="settings-group">
        <div class="theme-btn-group">
            <button class="t-btn" id="btn-light" onclick="setTheme('light')">Light</button>
            <button class="t-btn" id="btn-dark" onclick="setTheme('dark')">Dark</button>
            <button class="t-btn" id="btn-classic" onclick="setTheme('classic')">Classic</button>
        </div>
        <div class="setting-item">
            <span>Sprite Quality</span>
            <select id="sprite-quality" onchange="saveSetting('cc-sprite-quality', this.value)">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="Ultra">Ultra</option>
            </select>
        </div>
    </div>

    <div class="section-label">Account</div>
    <div class="settings-group">
        <div class="setting-item">
            <div class="item-info">
                <span>Email Address</span>
                <small id="display-email">Loading...</small>
            </div>
            <span class="action-link" onclick="changeEmail()">Change</span>
        </div>
        <div class="setting-item">
            <span>Password</span>
            <span class="action-link" onclick="resetPassword()">Reset Via Email</span>
        </div>
    </div>
</div>

<div class="nav-bottom">
    <a href="index.html" class="nav-item">üè†</a>
    <a href="discover.html" class="nav-item">üåê</a>
    <a href="creator.html" class="nav-item">‚ûï</a>
    <a href="settings.html" class="nav-item active">‚öôÔ∏è</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const SUPABASE_URL = 'https://mmycqeejhguzhtzkyjaj.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_8Du2GAcH5oBeiHWe-1e0Fg_XtSub2QE';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function saveSetting(key, value) {
        localStorage.setItem(key, value);
    }

    function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        saveSetting('cc-theme', theme);
        document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
        const btn = document.getElementById('btn-' + theme);
        if (btn) btn.classList.add('active');
    }

    async function loadAccount() {
        const { data: { user } } = await supabaseClient.auth.getUser();
        if (user) {
            const emailEl = document.getElementById('display-email');
            emailEl.innerText = user.new_email ? `${user.email} (Pending: ${user.new_email})` : user.email;
        } else {
            window.location.href = "login.html";
        }
    }

    async function changeEmail() {
        const newEmail = prompt("Enter your new email address:");
        if (!newEmail) return;
        const { error } = await supabaseClient.auth.updateUser({ email: newEmail });
        if (error) alert(error.message);
        else alert("Check confirmation links!");
    }

    async function resetPassword() {
        const { data: { user } } = await supabaseClient.auth.getUser();
        const { error } = await supabaseClient.auth.resetPasswordForEmail(user.email);
        alert(error ? error.message : "Reset link sent!");
    }

    function loadAllSettings() {
        loadAccount();
        setTheme(localStorage.getItem('cc-theme') || 'dark');
        document.getElementById('privacy-team').checked = localStorage.getItem('cc-privacy-team') !== 'false';
        document.getElementById('privacy-dm').checked = localStorage.getItem('cc-privacy-dm') !== 'false';
        document.getElementById('privacy-friends').checked = localStorage.getItem('cc-privacy-friends') !== 'false';
        document.getElementById('show-fps').checked = localStorage.getItem('cc-show-fps') === 'true';
        document.getElementById('privacy-followers').checked = localStorage.getItem('cc-privacy-followers') !== 'false';
        document.getElementById('privacy-requests').checked = localStorage.getItem('cc-privacy-requests') !== 'false';
        document.getElementById('swipe-dir').value = localStorage.getItem('cc-swipe-dir') || 'creator';
        document.getElementById('sprite-quality').value = localStorage.getItem('cc-sprite-quality') || 'Medium';
    }

    window.onload = loadAllSettings;
</script>

</body>
</html>