<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ComicCore ‚Äî Reaction Images</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Inter', sans-serif; background: #0f0f11; color: #f5f5f7; min-height: 100dvh; padding-bottom: 100px; }

.header {
position: sticky; top: 0; z-index: 200;
background: rgba(0,0,0,.95); padding: 16px 16px 14px;
border-bottom: 1px solid #1e1e20; backdrop-filter: blur(20px);
display: flex; align-items: center; gap: 14px;
}
.header h1 { font-size: 16px; font-weight: 900; margin: 0; flex: 1; }
.header span { font-size: 11px; color: #555; font-weight: 700; }

.upload-zone {
margin: 16px; border: 2px dashed #2a2a2c; border-radius: 16px;
padding: 28px 20px; text-align: center; cursor: pointer; transition: .2s;
background: #111;
}
.upload-zone:hover, .upload-zone.drag { border-color: #ff7a00; background: rgba(255,122,0,.05); }
.upload-zone .icon { font-size: 32px; margin-bottom: 8px; }
.upload-zone p { margin: 4px 0; font-size: 13px; color: #555; font-weight: 700; }
.upload-zone p strong { color: #ff7a00; }

.section-header {
display: flex; align-items: center; justify-content: space-between;
padding: 14px 16px 8px;
}
.section-title { font-size: 12px; font-weight: 900; color: #444; text-transform: uppercase; letter-spacing: 1px; }
.count-badge { font-size: 11px; color: #333; font-weight: 800; }

.images-grid {
display: grid; grid-template-columns: repeat(3, 1fr);
gap: 3px; padding: 0 16px;
}
@media (min-width: 480px) { .images-grid { grid-template-columns: repeat(4, 1fr); } }

.image-item {
position: relative; aspect-ratio: 1; background: #111; border-radius: 8px;
overflow: hidden; cursor: pointer; border: 2px solid transparent; transition: .2s;
}
.image-item:hover { border-color: #ff7a00; }
.image-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
.image-item .delete-btn {
position: absolute; top: 4px; right: 4px; width: 22px; height: 22px;
background: rgba(255,59,48,.9); border: none; border-radius: 50%; color: white;
font-size: 11px; cursor: pointer; display: flex; align-items: center; justify-content: center;
opacity: 0; transition: .15s; font-weight: 900;
}
.image-item:hover .delete-btn { opacity: 1; }
.image-item .name-tag {
position: absolute; bottom: 0; left: 0; right: 0;
background: rgba(0,0,0,.75); font-size: 9px; font-weight: 800; color: #aaa;
padding: 3px 5px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;
}

.empty-state { padding: 48px 20px; text-align: center; color: #333; font-size: 13px; line-height: 1.8; }

.toast {
position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px);
background: #1c1c1e; border: 1px solid #3a3a3c; color: #fff;
padding: 10px 20px; border-radius: 20px; font-size: 13px; font-weight: 700;
opacity: 0; transition: .25s; z-index: 9999; white-space: nowrap; pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

.bottom-nav {
position: fixed; bottom: 0; left: 0; right: 0;
background: rgba(0,0,0,.95); border-top: 1px solid #2c2c2e;
display: flex; justify-content: space-around; padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
z-index: 500; backdrop-filter: blur(12px);
}
.nav-item { font-size: 22px; cursor: pointer; opacity: .4; text-decoration: none; color: #f5f5f7; transition: .15s; }
.nav-item.active { opacity: 1; color: #ff7a00; }

.admin-note {
margin: 0 16px 16px; background: rgba(255,122,0,.08); border: 1px solid rgba(255,122,0,.2);
border-radius: 12px; padding: 12px 14px; font-size: 12px; color: #888; line-height: 1.5;
}
.admin-note strong { color: #ff7a00; }
</style>

</head>
<body>

<div class="header">
  <button onclick="history.back()" style="background:none;border:none;color:#666;font-size:20px;cursor:pointer;padding:0;">‚Üê</button>
  <h1>üé≠ Reaction Images</h1>
  <span id="img-count">0 images</span>
</div>

<div class="admin-note">
  <strong>How it works:</strong> Upload images here and they'll appear in the comment reaction picker on all comics ‚Äî like Discord's custom emoji/GIF tray. Anyone can use them to react to comments.
</div>

<div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
  <div class="icon">üì∏</div>
  <p><strong>Tap to upload</strong> reaction images</p>
  <p>PNG, JPG, GIF, WebP supported</p>
</div>
<input type="file" id="file-input" hidden accept="image/*" multiple>

<div class="section-header">
  <div class="section-title">Your Reaction Library</div>
  <div class="count-badge" id="grid-count"></div>
</div>

<div class="images-grid" id="images-grid">
  <div class="empty-state" style="grid-column:1/-1;">Loading...</div>
</div>

<div class="toast" id="toast"></div>

<div class="bottom-nav">
  <a href="index.html"    class="nav-item">üè†</a>
  <a href="discover.html" class="nav-item">üîç</a>
  <a href="teams.html"    class="nav-item">‚ö°</a>
  <a href="messages.html" class="nav-item">üí¨</a>
  <a href="profile.html"  class="nav-item active">üë§</a>
</div>

<script>
const _sb = supabase.createClient(
  'https://mmycqeejhguzhtzkyjaj.supabase.co',
  'sb_publishable_8Du2GAcH5oBeiHWe-1e0Fg_XtSub2QE'
);

const myProfile = JSON.parse(localStorage.getItem('user_profile') || '{"handle":"guest"}');
let reactionImages = JSON.parse(localStorage.getItem('cc-reaction-images') || '[]');
let toastTimer = null;

function showToast(msg) {
  const t = document.getElementById('toast');
  t.innerText = msg; t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
}

function saveAndRender() {
  localStorage.setItem('cc-reaction-images', JSON.stringify(reactionImages));
  renderGrid();
}

function renderGrid() {
  const grid = document.getElementById('images-grid');
  const count = reactionImages.length;
  document.getElementById('img-count').innerText = count + ' image' + (count !== 1 ? 's' : '');
  document.getElementById('grid-count').innerText = count + ' total';

  if (!count) {
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1;">No reaction images yet.<br>Upload some above!</div>';
    return;
  }

  grid.innerHTML = reactionImages.map((img, i) => `
    <div class="image-item" title="${img.name}">
      <img src="${img.src}" loading="lazy">
      <div class="name-tag">${img.name}</div>
      <button class="delete-btn" onclick="deleteImage(${i}, event)">‚úï</button>
    </div>
  `).join('');
}

function deleteImage(index, event) {
  event.stopPropagation();
  if (!confirm('Remove this reaction image?')) return;
  reactionImages.splice(index, 1);
  saveAndRender();
  showToast('Removed');
}

// File upload handler
document.getElementById('file-input').onchange = (e) => {
  const files = Array.from(e.target.files);
  let loaded = 0;
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      // Check for duplicate names
      const name = file.name.replace(/\.[^.]+$/, ''); // strip extension
      const exists = reactionImages.find(i => i.name === name);
      if (!exists) {
        reactionImages.push({ name, src: ev.target.result });
      }
      loaded++;
      if (loaded === files.length) {
        saveAndRender();
        showToast(`‚úÖ Added ${files.length} image${files.length !== 1 ? 's' : ''}`);
      }
    };
    reader.readAsDataURL(file);
  });
  e.target.value = '';
};

// Drag and drop
const zone = document.getElementById('upload-zone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag'));
zone.addEventListener('drop', e => {
  e.preventDefault(); zone.classList.remove('drag');
  const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
  if (!files.length) return;
  let loaded = 0;
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      const name = file.name.replace(/\.[^.]+$/, '');
      if (!reactionImages.find(i => i.name === name)) {
        reactionImages.push({ name, src: ev.target.result });
      }
      loaded++;
      if (loaded === files.length) {
        saveAndRender();
        showToast(`‚úÖ Added ${files.length} image${files.length !== 1 ? 's' : ''}`);
      }
    };
    reader.readAsDataURL(file);
  });
});

renderGrid();
</script>

</body>
</html>
