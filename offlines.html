<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="theme.css">
    <script src="theme.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComicCore | Offlines</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        /* colors now in theme.css */

        body { 
            margin: 0; 
            background: var(--bg); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            padding-bottom: 120px;
            user-select: none;
        }

        /* --- HEADER --- */
        .header {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .header h1 { margin: 0; font-size: 18px; font-weight: 900; letter-spacing: 1px; }
        .header h1 span { color: var(--accent); }

        /* --- STORAGE TRACKER --- */
        .storage-bar {
            padding: 15px 20px;
            background: #080808;
            border-bottom: 1px solid var(--border);
        }
        .meter-label { font-size: 10px; font-weight: 800; color: var(--text-dim); display: flex; justify-content: space-between; margin-bottom: 8px; }
        .meter-track { width: 100%; height: 6px; background: #222; border-radius: 10px; overflow: hidden; }
        #meter-fill { width: 0%; height: 100%; background: var(--accent); transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        /* --- GRID --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .draft-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            transition: transform 0.2s ease;
        }
        .draft-card:active { transform: scale(0.96); }

        .preview {
            width: 100%;
            height: 150px;
            background: #050505;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--border);
        }

        .card-info { padding: 12px; }
        .draft-name { font-weight: 800; font-size: 13px; margin-bottom: 4px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .draft-date { font-size: 9px; color: var(--text-dim); font-weight: 600; }

        .card-btns { display: flex; gap: 8px; margin-top: 12px; }
        .btn { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            border-radius: 8px; 
            font-size: 10px; 
            font-weight: 900; 
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-open { background: var(--accent); color: white; }
        .btn-del { background: #1a1a1a; color: var(--danger); }

        /* --- EMPTY STATE --- */
        #empty-view { text-align: center; padding: 80px 40px; }
        #empty-view .icon { font-size: 40px; margin-bottom: 15px; opacity: 0.2; display: block; }
        #empty-view p { color: var(--text-dim); font-size: 14px; font-weight: 600; line-height: 1.5; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        .btn-new {
            background: #fff;
            color: #000;
            padding: 16px 40px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 14px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-new:active { transform: scale(0.9); }
    </style>
</head>
<body>

    <div class="header">
        <h1>OFFLINE<span>S</span></h1>
        <button onclick="location.href='create.html'" style="background:rgba(255,255,255,0.1); border:none; color:white; width:35px; height:35px; border-radius:50%; font-weight:bold; cursor:pointer;">‚úï</button>
    </div>

    <div class="storage-bar">
        <div class="meter-label">
            <span>VAULT CAPACITY</span>
            <span id="usage-percent">0%</span>
        </div>
        <div class="meter-track">
            <div id="meter-fill"></div>
        </div>
    </div>

    <div id="empty-view" style="display: none;">
        <span class="icon">üìÅ</span>
        <p>No local drafts found.<br>Your offline comics appear here.</p>
    </div>

    <div id="draft-grid" class="grid"></div>

    <div class="bottom-nav">
        <button class="btn-new" onclick="createNew()">+ CREATE NEW</button>
    </div>

<script>
    function loadOfflines() {
        const drafts = JSON.parse(localStorage.getItem('comic_drafts') || '[]');
        const grid = document.getElementById('draft-grid');
        const empty = document.getElementById('empty-view');
        
        updateStorageMeter();

        if (drafts.length === 0) {
            grid.style.display = 'none';
            empty.style.display = 'block';
            return;
        }

        grid.style.display = 'grid';
        empty.style.display = 'none';
        grid.innerHTML = "";

        // Sort by most recently modified
        drafts.sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified));

        drafts.forEach(d => {
            const card = document.createElement('div');
            card.className = 'draft-card';
            
            // Thumbnail Logic
            const firstFrame = (d.data && d.data[0]) ? d.data[0] : null;
            const bg = firstFrame ? firstFrame.background : '#111';
            const isColor = bg.startsWith('#');

            card.innerHTML = `
                <div class="preview" style="${isColor ? 'background-color:'+bg : 'background-image:url('+bg+')'}">
                    ${!firstFrame ? '<span style="opacity:0.2; font-size:24px;">üìù</span>' : ''}
                </div>
                <div class="card-info">
                    <span class="draft-name">${d.title || 'Untitled Comic'}</span>
                    <span class="draft-date">${d.lastModified || 'Unknown date'}</span>
                    <div class="card-btns">
                        <button class="btn btn-open" onclick="openDraft('${d.id}')">RESUME</button>
                        <button class="btn btn-del" onclick="deleteDraft('${d.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function updateStorageMeter() {
        try {
            const stringified = JSON.stringify(localStorage);
            // 5MB is standard browser limit for localStorage
            const size = stringified.length;
            const percent = Math.min(Math.round((size / 5242880) * 100), 100);
            
            const fill = document.getElementById('meter-fill');
            fill.style.width = percent + '%';
            document.getElementById('usage-percent').innerText = percent + '%';

            // Change color if storage is nearly full
            if (percent > 80) fill.style.background = "#ff4444";
            else fill.style.background = "var(--accent)";
        } catch(e) {
            console.error("Storage calculation failed", e);
        }
    }

    function openDraft(id) {
        localStorage.setItem('active_draft_id', id);
        location.href = 'create.html';
    }

    function createNew() {
        localStorage.removeItem('active_draft_id'); 
        location.href = 'create.html';
    }

    function deleteDraft(id) {
        if (!confirm("Delete this draft permanently?")) return;
        
        let drafts = JSON.parse(localStorage.getItem('comic_drafts') || '[]');
        drafts = drafts.filter(d => d.id != id);
        localStorage.setItem('comic_drafts', JSON.stringify(drafts));
        
        // If we deleted the draft that was currently active in the creator
        if (localStorage.getItem('active_draft_id') == id) {
            localStorage.removeItem('active_draft_id');
        }
        
        loadOfflines();
    }

    // Refresh on focus (in case user saved in another tab)
    window.onfocus = loadOfflines;
    window.onload = loadOfflines;
</script>
</body>
=======
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="theme.css">
    <script src="theme.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComicCore | Offlines</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        /* colors now in theme.css */

        body { 
            margin: 0; 
            background: var(--bg); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            padding-bottom: 120px;
            user-select: none;
        }

        /* --- HEADER --- */
        .header {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .header h1 { margin: 0; font-size: 18px; font-weight: 900; letter-spacing: 1px; }
        .header h1 span { color: var(--accent); }

        /* --- STORAGE TRACKER --- */
        .storage-bar {
            padding: 15px 20px;
            background: #080808;
            border-bottom: 1px solid var(--border);
        }
        .meter-label { font-size: 10px; font-weight: 800; color: var(--text-dim); display: flex; justify-content: space-between; margin-bottom: 8px; }
        .meter-track { width: 100%; height: 6px; background: #222; border-radius: 10px; overflow: hidden; }
        #meter-fill { width: 0%; height: 100%; background: var(--accent); transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        /* --- GRID --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .draft-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            transition: transform 0.2s ease;
        }
        .draft-card:active { transform: scale(0.96); }

        .preview {
            width: 100%;
            height: 150px;
            background: #050505;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--border);
        }

        .card-info { padding: 12px; }
        .draft-name { font-weight: 800; font-size: 13px; margin-bottom: 4px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .draft-date { font-size: 9px; color: var(--text-dim); font-weight: 600; }

        .card-btns { display: flex; gap: 8px; margin-top: 12px; }
        .btn { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            border-radius: 8px; 
            font-size: 10px; 
            font-weight: 900; 
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-open { background: var(--accent); color: white; }
        .btn-del { background: #1a1a1a; color: var(--danger); }

        /* --- EMPTY STATE --- */
        #empty-view { text-align: center; padding: 80px 40px; }
        #empty-view .icon { font-size: 40px; margin-bottom: 15px; opacity: 0.2; display: block; }
        #empty-view p { color: var(--text-dim); font-size: 14px; font-weight: 600; line-height: 1.5; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        .btn-new {
            background: #fff;
            color: #000;
            padding: 16px 40px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 14px;
            border: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-new:active { transform: scale(0.9); }
    </style>
</head>
<body>

    <div class="header">
        <h1>OFFLINE<span>S</span></h1>
        <button onclick="location.href='create.html'" style="background:rgba(255,255,255,0.1); border:none; color:white; width:35px; height:35px; border-radius:50%; font-weight:bold; cursor:pointer;">‚úï</button>
    </div>

    <div class="storage-bar">
        <div class="meter-label">
            <span>VAULT CAPACITY</span>
            <span id="usage-percent">0%</span>
        </div>
        <div class="meter-track">
            <div id="meter-fill"></div>
        </div>
    </div>

    <div id="empty-view" style="display: none;">
        <span class="icon">üìÅ</span>
        <p>No local drafts found.<br>Your offline comics appear here.</p>
    </div>

    <div id="draft-grid" class="grid"></div>

    <div class="bottom-nav">
        <button class="btn-new" onclick="createNew()">+ CREATE NEW</button>
    </div>

<script>
    function loadOfflines() {
        const drafts = JSON.parse(localStorage.getItem('comic_drafts') || '[]');
        const grid = document.getElementById('draft-grid');
        const empty = document.getElementById('empty-view');
        
        updateStorageMeter();

        if (drafts.length === 0) {
            grid.style.display = 'none';
            empty.style.display = 'block';
            return;
        }

        grid.style.display = 'grid';
        empty.style.display = 'none';
        grid.innerHTML = "";

        // Sort by most recently modified
        drafts.sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified));

        drafts.forEach(d => {
            const card = document.createElement('div');
            card.className = 'draft-card';
            
            // Thumbnail Logic
            const firstFrame = (d.data && d.data[0]) ? d.data[0] : null;
            const bg = firstFrame ? firstFrame.background : '#111';
            const isColor = bg.startsWith('#');

            card.innerHTML = `
                <div class="preview" style="${isColor ? 'background-color:'+bg : 'background-image:url('+bg+')'}">
                    ${!firstFrame ? '<span style="opacity:0.2; font-size:24px;">üìù</span>' : ''}
                </div>
                <div class="card-info">
                    <span class="draft-name">${d.title || 'Untitled Comic'}</span>
                    <span class="draft-date">${d.lastModified || 'Unknown date'}</span>
                    <div class="card-btns">
                        <button class="btn btn-open" onclick="openDraft('${d.id}')">RESUME</button>
                        <button class="btn btn-del" onclick="deleteDraft('${d.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function updateStorageMeter() {
        try {
            const stringified = JSON.stringify(localStorage);
            // 5MB is standard browser limit for localStorage
            const size = stringified.length;
            const percent = Math.min(Math.round((size / 5242880) * 100), 100);
            
            const fill = document.getElementById('meter-fill');
            fill.style.width = percent + '%';
            document.getElementById('usage-percent').innerText = percent + '%';

            // Change color if storage is nearly full
            if (percent > 80) fill.style.background = "#ff4444";
            else fill.style.background = "var(--accent)";
        } catch(e) {
            console.error("Storage calculation failed", e);
        }
    }

    function openDraft(id) {
        localStorage.setItem('active_draft_id', id);
        location.href = 'create.html';
    }

    function createNew() {
        localStorage.removeItem('active_draft_id'); 
        location.href = 'create.html';
    }

    function deleteDraft(id) {
        if (!confirm("Delete this draft permanently?")) return;
        
        let drafts = JSON.parse(localStorage.getItem('comic_drafts') || '[]');
        drafts = drafts.filter(d => d.id != id);
        localStorage.setItem('comic_drafts', JSON.stringify(drafts));
        
        // If we deleted the draft that was currently active in the creator
        if (localStorage.getItem('active_draft_id') == id) {
            localStorage.removeItem('active_draft_id');
        }
        
        loadOfflines();
    }

    // Refresh on focus (in case user saved in another tab)
    window.onfocus = loadOfflines;
    window.onload = loadOfflines;
</script>
</body>
>>>>>>> ba49e38988dbbfe6054c14b4b3cd75b00beef1af
</html>