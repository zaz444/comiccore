<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ComicCore â€” Reader</title>

<meta property="og:title" content="ComicCoreâ„¢ - Create & Read">
<meta property="og:description" content="ComicCoreâ„¢ is a new app that lets you make comics using 2D sprites and arcade characters. No drawing skills needed, just customize the poses, angles, and frames to tell the creative story you want to.">
<meta property="og:image" content="https://media.discordapp.net/attachments/1472088820584419450/1475026485256523816/IMG_1777.png?ex=699bfcf6&is=699aab76&hm=4d03c9164ead0826a54cb0d5225719bbab724d2cf9296a72589bcb41db1f815d&=&format=webp&quality=lossless">
<meta property="og:url" content="https://zaz444.github.io/comiccore/">
<meta name="twitter:card" content="summary_large_image">

<link rel="stylesheet" href="theme.css">
<script src="theme.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;font-family:'Inter',sans-serif;background:#000;color:#fff;height:100dvh;overflow:hidden;display:flex;flex-direction:column;user-select:none;}

/* â”€â”€ Progress bar â”€â”€ */
.prog-track{position:fixed;top:0;left:0;right:0;height:3px;z-index:500;background:rgba(255,255,255,.08);}
.prog-fill{height:100%;background:var(--accent,#ff7a00);transition:width .4s cubic-bezier(.4,0,.2,1);}

/* â”€â”€ Top bar â”€â”€ */
.top-bar{position:fixed;top:0;left:0;right:0;height:60px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;z-index:400;background:linear-gradient(to bottom, rgba(0,0,0,.8),transparent);transition:transform .3s ease,opacity .3s ease;}
.top-bar.hidden{transform:translateY(-100%);opacity:0;}
.back-btn{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);text-decoration:none;color:#fff;font-weight:900;font-size:20px;transition:all .2s;}
.back-btn:active{transform:scale(.9);background:rgba(255,255,255,.2);}
.comic-meta{flex:1;margin:0 12px;overflow:hidden;}
.comic-title{font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:0;}
.comic-author{font-size:12px;opacity:.6;margin:0;}

/* â”€â”€ Viewport â”€â”€ */
#viewport{flex:1;position:relative;display:flex;align-items:center;justify-content:center;perspective:1000px;overflow:hidden;touch-action:none;}
.frame-container{width:100%;height:100%;position:relative;display:flex;align-items:center;justify-content:center;transition:transform .5s cubic-bezier(.2,0,0,1);}
.frame-img{max-width:100%;max-height:100%;object-fit:contain;box-shadow:0 20px 50px rgba(0,0,0,.5);opacity:0;transform:scale(.95);transition:all .5s cubic-bezier(.2,0,0,1);position:absolute;}
.frame-img.active{opacity:1;transform:scale(1);z-index:2;}

/* â”€â”€ Navigation HUD â”€â”€ */
.nav-hud{position:fixed;bottom:24px;left:0;right:0;display:flex;align-items:center;justify-content:center;gap:12px;z-index:400;transition:transform .3s ease,opacity .3s ease;}
.nav-hud.hidden{transform:translateY(100px);opacity:0;}
.nav-pill{background:rgba(20,20,20,.8);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:6px 12px;display:flex;align-items:center;gap:12px;}
.nav-btn{width:44px;height:44px;border-radius:14px;border:none;background:rgba(255,255,255,.05);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;}
.nav-btn:active{transform:scale(.9);background:rgba(255,255,255,.15);}
.page-counter{font-weight:700;font-variant-numeric:tabular-nums;font-size:14px;min-width:50px;text-align:center;}

/* â”€â”€ Overlays â”€â”€ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);z-index:1000;display:none;align-items:center;justify-content:center;padding:24px;}
.overlay.open{display:flex;}
.sheet{background:#111;border:1px solid rgba(255,255,255,.1);border-radius:28px;width:100%;max-width:400px;padding:24px;text-align:center;animation:sheetUp .4s cubic-bezier(.2,0,0,1);}
@keyframes sheetUp{from{transform:translateY(40px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.share-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin:20px 0;}
.share-item{background:rgba(255,255,255,.05);border-radius:16px;padding:16px;cursor:pointer;transition:all .2s;border:none;color:#fff;font-family:inherit;}
.share-item:active{background:rgba(255,255,255,.1);transform:scale(.95);}
.close-sheet{margin-top:12px;background:none;border:none;color:rgba(255,255,255,.4);padding:12px;cursor:pointer;font-weight:600;}

/* â”€â”€ Error state â”€â”€ */
#error-state{position:fixed;inset:0;background:#000;display:none;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center;z-index:2000;}
.err-icon{font-size:48px;margin-bottom:20px;}
.err-btn{background:var(--accent,#ff7a00);color:#fff;padding:12px 24px;border-radius:12px;text-decoration:none;font-weight:700;margin-top:20px;}
</style>
</head>
<body>

<div class="prog-track"><div id="prog-fill" class="prog-fill" style="width:0%"></div></div>

<div id="top-bar" class="top-bar">
  <a href="discover.html" class="back-btn">â†</a>
  <div class="comic-meta">
    <h1 id="comic-title" class="comic-title">Loading...</h1>
    <p id="comic-author" class="comic-author">Please wait</p>
  </div>
  <button onclick="openShare()" class="back-btn" style="background:rgba(255,122,0,.2);color:#ff7a00;font-size:16px;">Share</button>
</div>

<div id="viewport">
  <div id="frame-container" class="frame-container"></div>
</div>

<div id="nav-hud" class="nav-hud">
  <div class="nav-pill">
    <button onclick="prevFrame()" class="nav-btn">â†</button>
    <div class="page-counter"><span id="cur-page">1</span> / <span id="total-pages">1</span></div>
    <button onclick="nextFrame()" class="nav-btn">â†’</button>
  </div>
</div>

<div id="share-sheet" class="overlay" onclick="closeShare(event)">
  <div class="sheet">
    <div style="width:50px;height:4px;background:rgba(255,255,255,.2);border-radius:2px;margin:0 auto 20px;"></div>
    <h2 style="margin:0;font-weight:900;">Share Comic</h2>
    <p style="opacity:.6;font-size:14px;margin:8px 0 20px;">Show your friends this creation</p>
    <div class="share-grid">
      <button class="share-item" onclick="nativeShare()">
        <div style="font-size:24px;margin-bottom:8px;">ğŸ“±</div>
        <div style="font-weight:600;font-size:13px;">Send to...</div>
      </button>
      <button class="share-item" onclick="copyLink()">
        <div style="font-size:24px;margin-bottom:8px;">ğŸ”—</div>
        <div style="font-weight:600;font-size:13px;">Copy Link</div>
      </button>
    </div>
    <button class="close-sheet" onclick="document.getElementById('share-sheet').classList.remove('open')">Dismiss</button>
  </div>
</div>

<div id="error-state">
  <div class="err-icon">ğŸ›¸</div>
  <h2 style="font-weight:900;">Comic not found</h2>
  <p style="opacity:.6;">This story might have been deleted or moved.</p>
  <a href="discover.html" class="err-btn">Return Home</a>
</div>

<script>
// â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const supabase = supabase.createClient(
  localStorage.getItem('sb-url') || '',
  localStorage.getItem('sb-key') || ''
);

let comicId = new URLSearchParams(window.location.search).get('id');
let frames = [];
let currentIndex = 0;
let swipeDir = 'horizontal';
let shareUrl = "";

// â”€â”€ Initialization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
  if(!comicId) return showError();
  
  try {
    const { data: comic, error } = await supabase
      .from('comics')
      .select('*')
      .eq('id', comicId)
      .single();

    if(error || !comic) return showError();

    document.getElementById('comic-title').textContent = comic.title;
    document.getElementById('comic-author').textContent = `by ${comic.author_name || 'Anonymous'}`;
    
    // Load frames (stored as JSON array in Supabase)
    frames = comic.frames || [];
    if(frames.length === 0) return showError();

    document.getElementById('total-pages').textContent = frames.length;
    renderFrames();
    buildShareUrl();

  } catch(e) { showError(); }
}

function renderFrames() {
  const container = document.getElementById('frame-container');
  container.innerHTML = frames.map((f, i) => `
    <img src="${f.image_url}" class="frame-img ${i===0?'active':''}" data-index="${i}" loading="${i<2?'eager':'lazy'}">
  `).join('');
}

function nextFrame() {
  if(currentIndex < frames.length - 1) goTo(currentIndex + 1);
}

function prevFrame() {
  if(currentIndex > 0) goTo(currentIndex - 1);
}

function goTo(index) {
  const imgs = document.querySelectorAll('.frame-img');
  imgs[currentIndex].classList.remove('active');
  currentIndex = index;
  imgs[currentIndex].classList.add('active');
  
  document.getElementById('cur-page').textContent = currentIndex + 1;
  document.getElementById('prog-fill').style.width = `${((currentIndex + 1) / frames.length) * 100}%`;
}

// â”€â”€ UI Interactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetUI() {
  const tb = document.getElementById('top-bar');
  const hud = document.getElementById('nav-hud');
  tb.classList.toggle('hidden');
  hud.classList.toggle('hidden');
}

function openShare() {
  document.getElementById('share-sheet').classList.add('open');
}

function closeShare(e) {
  if(e.target.id === 'share-sheet') e.target.classList.remove('open');
}

// â”€â”€ Share Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildShareUrl() {
  const base = "https://zaz444.github.io/comiccore/";
  shareUrl = `${base}reader.html?id=${encodeURIComponent(comicId)}`;
}

async function nativeShare() {
  const shareData = {
    title: 'ComicCoreâ„¢',
    text: 'ComicCoreâ„¢ is a new app that lets you make comics using 2D sprites and arcade characters!',
    url: shareUrl
  };
  if(navigator.share) {
    try { await navigator.share(shareData); } catch(e) { if(e.name !== 'AbortError') copyLink(); }
  } else { copyLink(); }
}

function copyLink() {
  navigator.clipboard.writeText(shareUrl);
  const btn = document.querySelector('.share-item:last-child');
  const oldTxt = btn.innerHTML;
  btn.innerHTML = '<div style="font-size:24px;margin-bottom:8px;">âœ…</div><div style="font-weight:600;font-size:13px;">Copied!</div>';
  setTimeout(() => { btn.innerHTML = oldTxt; }, 2000);
}

function showError() {
  document.getElementById('error-state').style.display = 'flex';
}

// â”€â”€ Touch Handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let txX=0, txY=0, txT=0;
const vp = document.getElementById('viewport');
vp.addEventListener('touchstart',e=>{txX=e.touches[0].clientX;txY=e.touches[0].clientY;txT=Date.now();},{passive:true});
vp.addEventListener('touchend',e=>{
  const dx=txX-e.changedTouches[0].clientX, dy=txY-e.changedTouches[0].clientY, dt=Date.now()-txT;
  if(dt>700) return;
  if(Math.abs(dx)>45&&Math.abs(dx)>Math.abs(dy)){dx>0?nextFrame():prevFrame();return;}
  if(Math.abs(dx)<10&&Math.abs(dy)<10&&dt<280) resetUI();
},{passive:true});

// â”€â”€ Keyboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('keydown',e=>{
  if(document.getElementById('share-sheet').classList.contains('open')){
    if(e.key==='Escape') document.getElementById('share-sheet').classList.remove('open');
    return;
  }
  if(e.key==='ArrowRight') nextFrame();
  else if(e.key==='ArrowLeft') prevFrame();
});

init();
</script>
</body>
</html>